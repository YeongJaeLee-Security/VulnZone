<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@page import="ExploitsUtil.FileUpload"%>
<%@page import="ExploitsParam.FileUploadParams"%>
<%@ include file="../common/commonLevel.jsp"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<jsp:include page="../common/commonHead.jsp" />
</head>
<body>
	<%
	String userID = session.getAttribute("userID") != null ? (String) session.getAttribute("userID") : null;

	if (userID == null) {
	%>
	<script>
	const contextPath = '<%=request.getContextPath()%>
		'
		location.href = contextPath + '/auth/login.jsp'
	</script>
	<%
	} else {
	String uploadMessage = null;

	FileUploadParams fileUploadParams = new FileUploadParams(request);
	FileUpload fileUpload = new FileUpload(application);

	String result = currentLevel.equalsIgnoreCase("easy") ? fileUpload.low(fileUploadParams)
			: fileUpload.hard(fileUploadParams);

	uploadMessage = (result == null) ? "Your image was not uploaded." : result;

	request.setAttribute("uploadMessage", uploadMessage);
	RequestDispatcher dispatcher = request.getRequestDispatcher("fileUpload.jsp");
	dispatcher.forward(request, response);
	}
	%>
</body>
</html>