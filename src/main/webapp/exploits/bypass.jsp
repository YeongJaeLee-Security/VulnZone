<%@page import="ExploitsUtil.CSPBypass"%>
<%@page import="ExploitsParam.CSPBypassParams"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ include file="../common/commonLevel.jsp" %>
<%
String headerCSP = "script-src 'self' https://code.jquery.com/jquery-3.1.1.min.js 'nonce-inlineScriptLogin'";

if (currentLevel.equals("easy")) {
	headerCSP += " https://pastebin.com hastebin.com www.toptal.com example.com code.jquery.com https://ssl.google-analytics.com;";
} else {
	headerCSP +=  " 'unsafe-inline' 'nonce-RXZlcnl0aGluZyBnb25uYSBiZSBhbGwgcmlnaHQ=';";
	
	// Disable Cross-site scripting protections so that inline alert boxes will work
	response.setHeader("X-XSS-Protection", "0");
}

response.setHeader("Content-Security-Policy", headerCSP);
%>
<!DOCTYPE html>
<html>
<head>
<jsp:include page="../common/commonHead.jsp" />
</head>
<body>
	<jsp:include page="../common/commonHeader.jsp" />
	<%@ include file="../common/commonExploitsNavigation.jsp" %>
	
	<div class="container">
		<h2>Content Security Policy (CSP) Bypass: <em style="color: red;"><%= currentLevel %></em></h2>
		<%
		CSPBypassParams cspBypassParams = new CSPBypassParams(request);
		CSPBypass cspBypass = new CSPBypass();
		String result = currentLevel.equalsIgnoreCase("easy") ? cspBypass.easy(cspBypassParams) : cspBypass.hard(cspBypassParams);
		
		if (result != null) {
			out.println(result);
			}
		%>
	</div>
	
	<%@ include file="../common/commonFooter.jsp" %>
</body>
</html>