package ExploitsUtil;

import javax.servlet.http.HttpServletRequest;

import ExploitsParam.CSPBypassParams;

public class CSPBypass implements ExploitLevel<String, CSPBypassParams> {
	public CSPBypass() {
		
	}

	@Override
	public String easy(CSPBypassParams params) {
		if (params == null) {
			return null;
		}
		
		HttpServletRequest request = params.getRequest();
		StringBuilder stringBuilder = new StringBuilder();
		
		if (request.getMethod().equalsIgnoreCase("POST") && request.getParameter("include") != null) {
			String includeScript = request.getParameter("include");
			stringBuilder.append("<script src='" + includeScript + "'></script>");
		}
		
		stringBuilder.append("\n");
		stringBuilder.append("<p><em>You can include scripts from external sources, examine the Content Security Policy.</em></p>\n");
		stringBuilder.append("<div class=\"col-sm-6 col-md-6\">\n");
		stringBuilder.append("\t<div class=\"jumbotron\" style=\"padding-top: 20px;\">\n");
		stringBuilder.append("\t\t<p style=\"text-align: center; margin-top: 20px;\">Enter a URL to include</p>\n");
		stringBuilder.append("\t\t<form name=\"csp\" method=\"POST\">\n");
		stringBuilder.append("\t\t\t<div class=\"form-group\" style=\"margin-top: 20px;\">");
		stringBuilder.append("\t\t\t\t<input type=\"text\" id=\"include\" class=\"form-control\" placeholder=\"Enter a URL to include here...\" name=\"include\">\n");
		stringBuilder.append("\t\t\t</div>");
		stringBuilder.append("\t\t\t<input type=\"submit\" class=\"btn btn-primary form-control\" value=\"Include\" />\n");
		stringBuilder.append("\t\t</form>\n");
		stringBuilder.append("\t</div>\n");
		stringBuilder.append("</div>\n");
		
		return stringBuilder.toString();
	}

	@Override
	public String hard(CSPBypassParams params) {
		if (params == null) {
			return null;
		}
		
		HttpServletRequest request = params.getRequest();
		StringBuilder stringBuilder = new StringBuilder();
		
		if (request.getMethod().equalsIgnoreCase("POST") && request.getParameter("include") != null) {
			String includeContent = request.getParameter("include");
			stringBuilder.append(includeContent);
		}
		
		stringBuilder.append("\n");
		stringBuilder.append("<p><em>Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.</em></p>\n");
		stringBuilder.append("<div class=\"col-sm-6 col-md-6\">\n");
		stringBuilder.append("\t<div class=\"jumbotron\" style=\"padding-top: 20px;\">\n");
		stringBuilder.append("\t\t<p style=\"text-align: center; margin-top: 20px;\">Enter an alert box to pop up</p>\n");
		stringBuilder.append("\t\t<form name=\"csp\" method=\"POST\">\n");
		stringBuilder.append("\t\t\t<div class=\"form-group\" style=\"margin-top: 20px;\">");
		stringBuilder.append("\t\t\t\t<input type=\"text\" id=\"include\" class=\"form-control\" placeholder=\"Enter an alert box to pop up here...\" name=\"include\">\n");
		stringBuilder.append("\t\t\t</div>");
		stringBuilder.append("\t\t\t<input type=\"submit\" class=\"btn btn-primary form-control\" value=\"Include\" />\n");
		stringBuilder.append("\t\t</form>\n");
		stringBuilder.append("\t</div>\n");
		stringBuilder.append("</div>\n");
		
		return stringBuilder.toString();
	}
}