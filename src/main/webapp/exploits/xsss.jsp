<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ include file="../common/commonLevel.jsp" %>
<%@page import="ExploitsUtil.StoredXss"%>
<%@page import="ExploitsParam.StoredXssParams"%>
<%
StoredXss storedXss = new StoredXss();
%>

<!DOCTYPE html>
<html>
<head>
<jsp:include page="../common/commonHead.jsp" />
<script type="text/javascript" src="js/xssUtil.js"></script>
</head>
<body>
	<jsp:include page="../common/commonHeader.jsp" />
	<%@ include file="../common/commonExploitsNavigation.jsp" %>
	
	<div class="container">
		<h2>Stored Cross Site Scripting (XSS): <em style="color: red;"><%= currentLevel %></em></h2>
		
		<div class="col-sm-6 col-md-6">
			<div class="jumbotron" style="padding-top: 20px;">
				<form method="POST" name="guestform" action="">
					<div class="form-group" style="margin-top: 30px;">
						<input type="text" id="name" class="form-control" placeholder="Name" maxlength="10" name="name">
					</div>
					
					<div class="form-group">
						<textarea id="message" name="message" class="form-control" maxlength="50" required></textarea>
					</div>
					
					<input style="margin-top: 10px;" name="btnSign" type="submit" class="btn btn-primary form-control" onclick="return validateGuestbookForm(this.form);" value="Sign Guestbook" />
					
				</form>
				<%
				if (request.getParameter("btnSign") != null && request.getParameter("name") != null && request.getParameter("message") != null) {
					String name = request.getParameter("name");
					String message = request.getParameter("message");
					String method = request.getMethod();
					String action = request.getParameter("btnSign");
									
					StoredXssParams storedXssParams = new StoredXssParams(action, name, message, method);
									
					if (currentLevel.equalsIgnoreCase("easy")) {
						storedXss.easy(storedXssParams);
					} else { 
						storedXss.hard(storedXssParams);
					}
				}
				%>
				
				<form method="POST" name="guestClearForm" action="">
					<input style="margin-top: 10px;" name="btnClear" type="submit" class="btn btn-danger form-control" value="Clear Guestbook" />
				</form>
				
				<%
				if (request.getParameter("btnClear") != null) {
					storedXss.clearGuestbook();
				}
				%>
			</div>
			
			<%
			String result = storedXss.getGuestbook();

			if (result != null) {
				out.println(result);
			}
			%>
		</div>
	</div>
	
	<%@ include file="../common/commonFooter.jsp" %>
</body>
</html>